<div class="wrapper">
  <div *ngIf="(state$ | async) as state" style="padding: 0 10px">
    <app-path [node]="state$ | async"></app-path>
  </div>

  <table #header class="header" cellspacing="0">
    <thead *ngIf="(state$ | async) as state">
      <tr [style.height.px]="ROW_HEIGHT" style="background-color: lightgray">
        <th class="index">#</th>
        <th class="wilayah">{{ getWilayah(state) }}</th>
        <th class="paslon1">Tercakup</th>
        <th class="paslon2">Total TPS</th>
      </tr>
    </thead>
  </table>

  <table #footer class="footer" cellspacing="0">
    <tfoot *ngIf="(state$ | async) as state">
      <tr [style.height.px]="ROW_HEIGHT" style="background-color: lightgray">
        <th class="index"></th>
        <th class="wilayah" align="right">
          TOTAL ({{ state.children.length }}) &nbsp;
        </th>
        <th class="paslon1">
          {{ sum(state, 'tidakSah') | number }} /
          {{ sum(state, 'tidakSah') / sumTps(state) | number: '1.0-1' }}%
        </th>
        <th class="paslon2">{{ sumTps(state) | number }}</th>
      </tr>
    </tfoot>
  </table>

  <table #content class="content" cellspacing="0">
    <tbody *ngIf="(state$ | async) as state">
      <ng-container
        *ngFor="
          let c of state.children;
          let index = index;
          let odd = odd;
          trackBy: trackByIdx
        "
      >
        <tr
          [style.height.px]="ROW_HEIGHT"
          [style.background-color]="odd ? '#FFF' : '#EEE'"
        >
          <td class="index">{{ index + 1 }}</td>
          <td class="wilayah">
            <a
              [routerLink]="[state.depth < 3 ? '/h' : '/t', c[0]]"
              class="link"
              >{{ c[1] | uppercase }}</a
            >
            <ng-container *ngIf="state.data[c[0]] as d">
              <ng-container *ngIf="d.sum.pending || d.sum.error">
                (<span *ngIf="d.sum.pending" style="color: orange">{{
                  d.sum.pending
                }}</span
                ><ng-container *ngIf="d.sum.error"
                  ><ng-container *ngIf="d.sum.pending && d.sum.error"
                    >/</ng-container
                  ><span *ngIf="d.sum.error" style="color: red">{{
                    d.sum.error
                  }}</span></ng-container
                >)
              </ng-container>
            </ng-container>
            {{ ago(state, c[0]) }}
          </td>
          <td class="paslon1">
            {{ coverage(state, c[0]) | number }} /
            {{ coverage(state, c[0]) / c[2] | number: '1.0-1' }}%
          </td>
          <td class="paslon2">
            {{ c[2] | number }}
          </td>
        </tr>
      </ng-container>
    </tbody>
  </table>
</div>
