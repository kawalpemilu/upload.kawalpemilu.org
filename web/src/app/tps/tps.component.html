<div *ngIf="(state$ | async) as state" class="wrapper">
  <app-path [node]="state"></app-path>

  <button
    mat-raised-button
    color="warn"
    [routerLink]="['/d', state.id]"
    *ngIf="
      state.numPending > 0 &&
      (userService.userRelawan$ | async)?.d < MAX_TRUSTED_DEPTH
    "
  >
    Digitize {{ state.numPending }} uploads
  </button>

  <p></p>

  <table cellspacing="0">
    <tr [style.height.px]="40" style="background-color: lightgray">
      <th class="tps">TPS</th>
      <th class="foto">Tes Upload Foto</th>
    </tr>
    <tr
      *ngFor="let tps of state.tpsList; let odd = odd"
      [style.background-color]="odd ? '#FFF' : '#EEE'"
    >
      <th class="tps">
        <p>TPS #{{ tps.tpsNo }}</p>
        <table
          *ngIf="tps.aggregate as a"
          border="1"
          style="margin: 0 auto"
          cellspacing="0"
          [style.backgroundColor]="a.s[5] ? '#FDD' : a.s[4] ? '#FFD' : ''"
        >
          <tr>
            <td class="label">Pas1:</td>
            <td class="angka">{{ a.s[0] }}</td>
          </tr>
          <tr>
            <td>Pas2:</td>
            <td class="angka">{{ a.s[1] }}</td>
          </tr>
          <tr>
            <td>Sah:</td>
            <td class="angka">{{ a.s[2] }}</td>
          </tr>
          <tr>
            <td>~Sah:</td>
            <td class="angka">{{ a.s[3] }}</td>
          </tr>
        </table>

        <p></p>
      </th>
      <td class="foto">
        <table cellpadding="0" cellspacing="0" width="100%">
          <tr>
            <td width="125">
              <ng-container
                *ngIf="tps.aggregate?.u as servingUrl; else adapending"
              >
                <app-thumbnail [url]="servingUrl" [size]="125"></app-thumbnail>
              </ng-container>
              <ng-template #adapending>
                <div *ngIf="(tps.aggregate?.s)[4]">
                  Ada foto yang masuk dan belum diproses.
                </div>
              </ng-template>
            </td>
            <td align="center">
              <p *ngIf="tps.aggregate as a">
                <span *ngIf="a.s[5]; else bisalapor" style="color: red"
                  >{{ 'nama' }} melaporkan ada kesalahan di TPS ini</span
                >
                <ng-template #bisalapor>
                  <button
                    *ngIf="(userService.user$ | async) as user"
                    mat-raised-button
                    color="warn"
                    (click)="laporKesalahan(user, a.i)"
                  >
                    Laporkan Kesalahan
                  </button>
                </ng-template>
              </p>

              <p>
                <button
                  *ngIf="!uploadService.task"
                  mat-raised-button
                  [routerLink]="['/u', state.id, tps.tpsNo]"
                  color="primary"
                >
                  Jaga TPS / Upload Foto
                </button>
              </p>
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
</div>
