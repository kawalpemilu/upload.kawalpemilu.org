<ng-container *ngIf="(userService.relawan$ | async) as relawan">
  <h2>Rekrutmen Relawan</h2>

  <p>
    Halo,
    <app-orang [profile]="relawan.profile"></app-orang>
  </p>

  <ng-template #register>
    <ng-container *ngIf="(code$ | async) as code">
      <p>
        <app-orang [profile]="code.issuer"></app-orang>
        mengundang Anda untuk menjadi Relawan.
      </p>

      <button
        [disabled]="isLoading"
        mat-raised-button
        color="primary"
        (click)="registerCode(relawan.auth, code)"
      >
        Terima Undangan
      </button>
    </ng-container>

    <p style="font-weight: bold; color: red" *ngIf="error">{{ error }}</p>
  </ng-template>

  <ng-container *ngIf="relawan.depth > 0; else register">
    <p>
      Relawan KawalPemilu 2019 memiliki tanggung jawab besar untuk mengawal
      suara rakyat. Idealnya, kita butuh sekitar 800.000 Relawan yang terpencar
      di seluruh kelurahan di Indonesia untuk mengawal TPS masing-masing. Ya,
      ada 800.000 TPS yang perlu dijaga! Banyak, kan?
    </p>
    <p>
      Mulai sekarang sampai tanggal <b>15 April 2019</b>, semua Relawan diminta
      untuk uji coba <a [routerLink]="['/f']">upload foto</a> di TPS yang akan
      dikawal. Dari situ kita akan tahu bahwa TPS tersebut sudah akan terkawal
      di hari-H. Anda dapat melihat penyebaran Relawan saat ini di
      <a [routerLink]="['/h', 0]">Cakupan TPS</a>.
    </p>

    <p>
      Bantuan Anda untuk merekrut teman-teman Anda menjadi Relawan di kelurahan
      yang BELUM dikawal sangat diharapkan. Jika Anda memiliki teman Facebook
      yang bertempat tinggal di kelurahan tersebut, undanglah mereka dengan kode
      referral di bawah ini:
    </p>

    <form [formGroup]="formGroup">
      <mat-form-field style="width: 225px">
        <input
          matInput
          autocomplete="off"
          placeholder="Nama teman anda"
          formControlName="namaCtrl"
          type="text"
          required
        />
      </mat-form-field>
      &nbsp;
      <span *ngIf="getError('namaCtrl') as error" class="alert">
        {{ error }}
      </span>

      <button
        type="submit"
        [disabled]="formGroup.invalid || isLoading"
        mat-raised-button
        color="primary"
        (click)="createReferralCode(relawan.auth)"
      >
        Buat Kode Referral
      </button>
    </form>

    <ng-container *ngIf="getReferralCodes(relawan, false) as codes">
      <ng-container *ngIf="codes.length > 0">
        <p>
          Kirimkan URL kode referral dibawah ini ke teman anda (satu kode
          referral hanya bisa dipakai oleh satu orang):
        </p>

        <table border="1" cellspacing="0">
          <tr bgcolor="lightgray">
            <th width="30">#</th>
            <td><b>Nama</b></td>
            <td><b>URL kode referral untuk dibagikan</b></td>
          </tr>
          <tr
            *ngFor="let code of codes; let odd = odd; let i = index"
            [style.background-color]="odd ? '#FFF' : '#EEE'"
          >
            <td align="center">{{ i + 1 }}</td>
            <td>{{ relawan.code[code].name }}</td>
            <td style="padding: 7px">
              <input
                type="text"
                style="width: 300px"
                value="https://upload.kawalpemilu.org/c/{{ code }}"
                #ui
              />
              &nbsp;
              <button mat-raised-button color="primary" (click)="copyCode(ui)">
                <mat-icon>file_copy</mat-icon> Copy
              </button>
            </td>
          </tr>
        </table>
      </ng-container>
    </ng-container>

    <ng-container *ngIf="getReferralCodes(relawan, true) as codes">
      <ng-container *ngIf="codes.length > 0">
        <p>
          Berikut ini adalah teman-teman yang sudah menerima undangan anda:
        </p>

        <table border="1" cellpadding="5" cellspacing="0">
          <tr bgcolor="lightgray">
            <th width="30">#</th>
            <th>Nama</th>
            <th>Profile teman anda</th>
          </tr>
          <tr
            *ngFor="let code of codes; let odd = odd; let i = index"
            [style.background-color]="odd ? '#FFF' : '#EEE'"
          >
            <ng-container *ngIf="relawan.code[code] as c">
              <td align="center">{{ codes.length - i }}</td>
              <td>{{ c.name }}</td>
              <td>
                <app-orang [profile]="c.claimer"></app-orang>
              </td>
            </ng-container>
          </tr>
        </table>
      </ng-container>
    </ng-container>
  </ng-container>
</ng-container>

<br /><br />
