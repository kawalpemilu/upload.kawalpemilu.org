<ng-container *ngIf="(code$ | async) as code; else gaAdaKode">
  <ng-container *ngIf="(userService.relawan$ | async) as relawan; else publik">
    <p>
      <app-orang [profile]="code.issuer"></app-orang>
      mengundang kamu menjadi relawan KawalPemilu - Jaga Suara 2019.
    </p>

    <button
      [disabled]="isLoading"
      mat-raised-button
      color="primary"
      (click)="registerCode(relawan.auth, code)"
    >
      Terima Undangan
    </button>
  </ng-container>

  <ng-template #publik>
    <p>
      <b>{{ code.issuer.name }}</b>
      mengundang kamu menjadi relawan KawalPemilu untuk menjaga suara TPS di
      kelurahan kamu. Detailnya akan dijelaskan setelah kamu terima undangannya.
    </p>

    <p>Untuk menerima undangan, kamu harus login terlebih dahulu:</p>

    <button
      style="width: 250px; text-align: left"
      mat-raised-button
      (click)="userService.login('facebook')"
    >
      <img
        style="padding:8px"
        src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAHsSURBVGhD7ZjNLgNhGEZ7ZS1i5a/TEvdDLCywE0sXoTMSEZZW4t8FWEqIlg0Lo41nIprzxfv1pWMxJzm7d56e9GfTWkVFRcX/ptFMk3orPa63Oi+NVpqPw8Frfb7m3oIyRqORpOv0AmN2TTlxTCSdJoyVYr2ZzSvLzuAjpLFSTNIjZdkZ53feYE9ZdmCkVJVlh0bKVFl2aMTr1FKWb+xc5efXD3m395q/v+ffoGcKlWWHRjxOLmb5yem9Uhl6rlBZdmjE42b/nf8Jeq5QWXZoxOPFzYMyw9BzhcqyQyMeu89vyvxidessn17ex/thlWWHRjwO/2AHTLYzvCWVZYdGPBJ0F1JZdmjEI0F3IZVlh0ZijeGp+4obhcqyQyOxxnB5+4gbhcqyQyOxxrB3cIcbhcqyQyOxxrC9e4sbhcqyQyMeCboLqSw7NOKRoLuQyrJDIx4JugupLDs04pGgu5DKskMjHgm6C6ksOzTikaC7kMqyQyMeCboLqSw7NOKRoLuQyrJDIx4JugupLDs04pGgu5DKskMjHgm6C6ksOzTikaC7kMqy89t/LRJ0F3CEvxaT9AiGynGkP3eb2TyOleBEqzOrrDj6D68Nj5XginJGo//xzenr1Bsa/kt7/d/gYb2dzSijoqKi4l9Sq30A+M9r/MIZv3oAAAAASUVORK5CYII="
      />
      Login with Facebook
    </button>
  </ng-template>
</ng-container>

<ng-template #gaAdaKode>
  <ng-container
    *ngIf="(userService.relawan$ | async) as relawan; else butuhKode"
  >
    <h2>Rekrut Teman Jadi Relawan</h2>

    <p>
      Halo,
      <app-orang [profile]="relawan.profile"></app-orang>
    </p>

    <ng-template #register>
      Maaf, kamu memerlukan kode referral untuk mengakses halaman ini.
    </ng-template>

    <ng-container *ngIf="relawan.depth > 0; else register">
      <p>
        Relawan KawalPemilu 2019 punya tanggung jawab besar untuk mengawal suara
        rakyat. Data di formulir <b>C1 plano</b> adalah data Pemilu paling
        otentik, karenanya partisipasi publik untuk meng-upload foto C1 plano
        sangat diharapkan.
      </p>
      <p>
        Idealnya, kita butuh lebih dari 800.000 Relawan di seluruh kelurahan
        Indonesia untuk mengawal TPS. Ya, ada 800.000+ TPS yang perlu dijaga!
        Banyak, kan?
      </p>
      <p>
        Karenanya, ayo rekrut teman-teman kamu di kelurahan yang
        <b>BELUM dikawal</b>
        untuk ikut jadi Relawan yang meng-upload foto C1 plano! Jika kamu punya
        teman Facebook yang bertempat tinggal di kelurahan tersebut (<a
          [routerLink]="['/h', 0]"
          >lihat Cakupan TPS</a
        >), ayo undang mereka dengan memberikan kode referral di bawah ini:
      </p>

      <p>
        <b style="color: red">Catatan penting</b>: Mulai sekarang sampai tanggal
        <b>15 April 2019</b>, semua Relawan diminta untuk mencoba
        <a [routerLink]="['/foto']" style="font-weight: bold">upload foto</a>
        di area sekitar TPS yang akan dikawal.
      </p>

      <form [formGroup]="formGroup">
        <mat-form-field style="width: 275px">
          <input
            matInput
            autocomplete="off"
            placeholder="Nama teman kamu (dicantumkan di undangan)"
            formControlName="namaCtrl"
            type="text"
            required
          />
        </mat-form-field>
        &nbsp;
        <span *ngIf="getError('namaCtrl') as error" class="alert">
          {{ error }}
        </span>

        <button
          type="submit"
          [disabled]="formGroup.invalid || isLoading"
          mat-raised-button
          color="primary"
          (click)="createReferralCode(relawan.auth)"
        >
          Buat Kode Referral
        </button>
      </form>

      <ng-container *ngIf="getReferralCodes(relawan, false) as codes">
        <ng-container *ngIf="codes.length > 0">
          <p>
            Kirimkan URL kode referral dibawah ini ke teman kamu (satu kode
            referral hanya bisa dipakai oleh satu orang):
          </p>

          <table border="1" cellspacing="0">
            <tr bgcolor="lightgray">
              <th width="30">#</th>
              <td><b>Nama</b></td>
              <td><b>URL kode referral untuk dibagikan</b></td>
            </tr>
            <tr
              *ngFor="let code of codes; let odd = odd; let i = index"
              [style.background-color]="odd ? '#FFF' : '#EEE'"
            >
              <td align="center">{{ i + 1 }}</td>
              <td>{{ relawan.code[code].name }}</td>
              <td style="padding: 7px">
                <input
                  type="text"
                  style="width: 300px"
                  value="https://upload.kawalpemilu.org/c/{{ code }}"
                  #ui
                />
                &nbsp;
                <button
                  mat-raised-button
                  color="primary"
                  (click)="copyCode(ui)"
                >
                  <mat-icon>file_copy</mat-icon> Copy
                </button>
              </td>
            </tr>
          </table>
        </ng-container>
      </ng-container>

      <ng-container *ngIf="getReferralCodes(relawan, true) as codes">
        <ng-container *ngIf="codes.length > 0">
          <p>
            Total downstream referral kamu adalah
            <b style="color: blue">{{ relawan.profile.dr4 || 0 }}</b
            >. Berikut ini adalah teman-teman yang sudah menerima undangan kamu
            beserta total downstream referral mereka:
          </p>

          <table border="1" cellpadding="5" cellspacing="0">
            <tr bgcolor="lightgray">
              <th width="30">#</th>
              <th>Nama</th>
              <th>Profile teman kamu</th>
            </tr>
            <tr
              *ngFor="let code of codes; let odd = odd; let i = index"
              [style.background-color]="odd ? '#FFF' : '#EEE'"
            >
              <ng-container *ngIf="relawan.code[code] as c">
                <td align="center">{{ codes.length - i }}</td>
                <td>{{ c.name }}</td>
                <td>
                  <app-orang [profile]="c.claimer"></app-orang>
                  ({{ c.claimer.dr4 || 0 }})
                </td>
              </ng-container>
            </tr>
          </table>
        </ng-container>
      </ng-container>
    </ng-container>
  </ng-container>
</ng-template>

<ng-template #butuhKode>
  <app-login></app-login>
</ng-template>

<br /><br />
